name: Update Cloudflare IP JSON

on:
  schedule:
    - cron: '0 2 * * *' # 每天凌晨 2 点自动运行
  workflow_dispatch:     # 支持手动运行

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3

    - name: Set up Environment
      run: sudo apt update && sudo apt install -y curl jq nmap

    - name: Download Cloudflare IPs and Generate JSON
      run: |
        chmod +x collect_ips.sh
        ./collect_ips.sh

    - name: Commit and Push
      run: |
        git config user.name github-actions[bot]
        git config user.email github-actions[bot]@users.noreply.github.com
        git add .
        git commit -m "🤖 Update Cloudflare IP JSON by Country"
        git push
